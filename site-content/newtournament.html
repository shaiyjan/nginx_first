<!DOCTYPE html>
<html>

<!--# include virtual="template/header.html" -->
<!--# include virtual="template/nav.html" -->



<article id="mainwindow">



    <div style="margin-bottom:.5cm;">
        <form id="metadata_form" >
                <label for="tournament_name" style="margin-bottom:.5cm;"> Name of the Tournament:</label>
                <input id="tournament_name" input="text">
                <br>
                <label for="mode-select">Choose a tournament mode:</label>
                <select name="mode" id="mode-select">
                    <option value="">--Please choose an option--</option>
                    <option value="ko">K.O.</option>
                    <option value="doubleko">Double K.O.</option>
                    <option value="rr">Round-Robin</option>
                </select>
                <br>
                <label for="pre_select" > Number of preliminaries: </label>
                <select name="pre_num" id ="pre_select">
                    <option value="0"> 0 </option>
                    <option value="1" selected="selected"> 1 </option>
                    <option value="2"> 2 </option>
                </select>
                <br>
                <label for="p_count">Number of participants:</label>
                <input type="text" name="participant_count" id="p_count" disabled>

        </form>
    </div>

    <div>
        <table id = "tour_list">
            <tr>
                <th> SignUp List </th>
                <th> Participants </th>
                <th> Already selected </th>
            </tr>
        </table>
    </div>


    <script>


        async function updateTotal() {
            let liststr = "";

            const container=document.getElementById("tour_list");
            const checkboxes = container.querySelectorAll(".vBox");

            const total_text = document.getElementById("p_count")


            checkboxes.forEach(checkbox => {
                if (checkbox.checked){
                    liststr += checkbox.getAttribute('data-value') + "%";
                }

            })
            const response = await fetch(window.domain + "/signup_overlap/" + liststr)
            if (!response.ok){
                console.log("signup total failed")
            }
            const data = await response.json()
            
            total_text.value = data[0]
            }


        async function signuplists(url) {
            const response = await fetch(url);
            if (!response.ok) {
                console.log("failed to fetch from " & url);
            }
            const data = await response.json();
            for (const [key,value] of Object.entries(data)) {
                    const li = document.createElement("tr");
                    const  tdn = document.createElement("td");
                    const  tdp = document.createElement("td");
                    const  tdc = document.createElement("td");
                    tdn.textContent = value[1];
                    tdp.textContent = value[2];
                    const include_box = document.createElement("input");
                    include_box.type = "checkbox";
                    include_box.name = "Include";
                    include_box.value = 0;
                    include_box.className = "vBox";
                    include_box.dataset.value = value[0] ;
                    include_box.addEventListener('change', updateTotal)
                    tdc.appendChild(include_box);
                    li.appendChild(tdn);
                    li.appendChild(tdp);
                    li.appendChild(tdc);
                    const list = document.getElementById("tour_list");
                    list.appendChild(li)
            }





        }
        signuplists(window.domain + '/signup_extra')
    </script>







</article>






<!--# include virtual="template/footer.html" -->
</html>